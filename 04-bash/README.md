04-bash
===

# Запуск
```bash
$ ./opt/message.sh

# Просмотреть сообщение со статистикой
$ cat /tmp/messages/message
```

# Алгоритм
1. В `message.sh` экспортируются переменные из `setenv.sh` и функции из `core.sh`.
2. Проверяется существование `lockfile`. Пытаемся записать PID текущего процесса в `lockfile`. Если файл уже существует, то из-за опции `noclobber` будет ошибка. Таким образом реализован запрет на мультизапуск.
3. Устанавливаем `trap` на сигналы `SIGINT`, `SIGTERM`, `SIGEXIT` и `SIGKILL`. В случае перехвата выполняется функция `stop`.
4. Пытаемся найти файл `state`, в котором записаны начало и конец предыдущего парсинга файла `access.log`. Ищем, сколько строк пропустить для текущего парсинга. В случае, если файла нет, то не пропускаем строки.
5. Пропускаем строки в `access.log` и начинаем построчно и бесконечно перезаписывать файл в `tmp.log`. В дальнейшем будем парсить именно его.
6. При выключении процесса сигналами, описанными выше, запускается функция `stop`. Данная функция:
    1. Из `tmp.log` вытаскивает даты первой и последней строчки и записывает в `state` файл;
    2. Парсить `tmp.log`, генерируя `message` файл;
    3. Отправляет `message` файл по указанной электронной почте;
    4. Убирает `lockfile` и возвращает первоначальный `exit code` из перехваченного сигнала. 
    